# Pre-commit hooks for datui
# Install with: pre-commit install
# Run manually with: pre-commit run --all-files

repos:
  # Keep local dev tag in sync with remote (avoids push/pull issues when dev is force-updated)
  - repo: local
    hooks:
      - id: fetch-dev-tag
        name: fetch dev tag
        entry: bash -c 'timeout 1 git fetch origin refs/tags/dev:refs/tags/dev --force 2>/dev/null || true'
        language: system
        pass_filenames: false
        always_run: true
        description: Force-fetch dev tag from origin so local ref stays in sync

  # Rust formatting with cargo fmt
  - repo: local
    hooks:
      - id: cargo-fmt
        name: cargo fmt
        entry: bash -c 'if ! ./scripts/check_format.sh; then ./scripts/format.sh && echo "Code formatted - please stage changes and commit again" && exit 1; fi'
        language: system
        pass_filenames: false
        always_run: true
        description: Format Rust code with cargo fmt

  # Rust linting with cargo clippy
  - repo: local
    hooks:
      - id: cargo-clippy
        name: cargo clippy
        entry: ./scripts/check_clippy.sh
        language: system
        pass_filenames: false
        always_run: true
        description: Run cargo clippy with all targets and deny warnings
